!function(a){var b=window.$.Deferred,c=window.$.ajax;$.ajaxSetup&&$.ajaxSetup({xhrFields:{withCredentials:!0}});var d=function(a,b){if(!b)return a;var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},e={ajax:{error:-1,msg:"请求失败，请检查网络连接状况。"},missingParameters:{error:-2,msg:"参数不全"}},f=function(){var a,b,c={},d=window.location.search.substr(1).split("&");if(""===d[0])return c;for(a=0;a<d.length;a++)b=d[a].split("="),c[b[0].toLowerCase()]=decodeURIComponent(b[1]);return c}(),g={},h=function(a){return f[a.toLowerCase()]};g.getParam=h;var i="uc.cn",j="aliopen",k="//wdj.account.test.uc.cn",l="//openplatform.test2.uae.uc.cn",m={from:{aliOpen:j},host:k,mainHost:l,postfix:i};window.location.href.indexOf(i)>-1&&("wdjaccount.open.uc.cn"==window.location.host&&(m.host="https://wdjaccountapi.open.uc.cn",m.mainHost="//open.uc.cn"),f.from=m.from.aliOpen);var n=h("from")===m.from.aliOpen?m.host:"https://account.wandoujia.com",o=h("from")===m.from.aliOpen?m.host:"http://www.wandoujia.com/api/account",p="/v4/api",q=navigator.userAgent.toLowerCase().indexOf("msie")>-1,r=(q?o:n)+p,s={login:r+"/login",logout:r+"/logout",captcha:r+"/seccode",reg:r+"/register",checkUsername:r+"/isUsernameExisted",checkUserLogin:r+"/profile",checkUserLoginWithAuth:r+"/profile_with_auth",findPwd:r+"/findpassword",checkCode:r+"/checkcode",resetPwd:r+"/resetpassword",modifyPwd:r+"/profile/password",checkPasscode:r+"/checkpasscode",modifyPwdByCode:r+"/modifypassword",completeProfile:r+"/completeProfile",activate:r+"/activation/initialization",activateValid:r+"/activation/validation",unbindThirdParty:r+"/social/unbind",avatar:r+"/avatar",confirm:r+"/account/confirm"},t={loginWithThirdParty:n+"/web/oauth2/{1}/login"},u={},v=!1,w={};w.CAPTCHA=s.captcha,w.loginAsync=function(a,f){var g=new b;return a=a||{},f=f||{},a.username&&a.password?c({type:"POST",dataType:"json",url:s.login,data:d({username:a.username,password:a.password,seccode:a.seccode||""},f),success:function(a,b,c){0===a.error?(a.member.auth=c.getResponseHeader("X-Wdj-Auth"),v=!0,u=a.member,g.resolve(a.member)):1000004===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}):g.reject(e.missingParameters),g.promise()},w.isLogined=function(){return v},w.getUserInfo=function(){return u||{}},w.logoutAsync=function(a){var d=new b;a=a||{};var f=!!a.jsonp;return delete a.jsonp,c({type:"POST",dataType:f?"jsonp":"json",url:s.logout,data:a,crossDomain:f?!0:void 0,success:function(a){0===a.error?(v=!1,u=void 0,d.resolve(a)):d.reject(a)},error:function(a){4===a.readyState&&d.reject(a.responseJSON||{}),d.reject(e.ajax)}}),d.promise()},w.regAsync=function(a,f){var g=new b;return a=a||{},f=f||{},a.username&&(a.oneKeyRegister||a.password)?c({type:"POST",dataType:"json",url:s.reg,data:d({username:a.username,password:a.password,oneKeyRegister:a.oneKeyRegister||!1,nick:a.nickname||"",seccode:a.seccode||""},f),success:function(a,b,c){0===a.error?(a.member.auth=c.getResponseHeader("X-Wdj-Auth"),v=!0,u=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}):g.reject(e.missingParameters),g.promise()},w.checkUsernameAsync=function(a,f){var g=new b;return f=f||{},void 0===a?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:s.checkUsername,data:d({username:a},f),success:function(a){g.resolve(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},w.checkUserLoginAsync=function(a){var d=new b;a=a||{};var e=!!a.jsonp;return delete a.jsonp,c({type:"GET",dataType:e?"jsonp":"json",url:s.checkUserLogin,data:a,crossDomain:e?!0:void 0,success:function(a){0===a.error?(v=!0,u=a.member,d.resolve(!0)):(v=!1,u=void 0,d.reject(!1))},error:function(){d.reject(!1)}}),d.promise()},w.checkUserLoginWithAuthAsync=function(a){var d=new b;a=a||{};var f=!!a.jsonp;return delete a.jsonp,c({type:"GET",dataType:f?"jsonp":"json",url:s.checkUserLoginWithAuth,data:a,crossDomain:f?!0:void 0,success:function(a,b,c){0===a.error?(a.member.auth=c.getResponseHeader("X-Wdj-Auth"),v=!0,u=a.member,d.resolve(a.member)):(v=!1,u=void 0,d.reject(a))},error:function(a){4===a.readyState&&d.reject(a.responseJSON||{}),d.reject(e.ajax)}}),d.promise()},w.findPwdAsync=function(a,f){var g=new b;return f=f||{},void 0===a?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:s.findPwd,data:d({username:a},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},w.checkCodeAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.username||void 0===a.passcode?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:s.checkCode,data:d({username:a.username,passcode:a.passcode},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},w.resetPwdAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.username||void 0===a.passcode||void 0===a.password?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:s.resetPwd,data:d({username:a.username,passcode:a.passcode,password:a.password,repeatedpassword:a.password},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},w.modifyPwdAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.password||void 0===a.newpassword?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:s.modifyPwd,data:d({oldpassword:a.password,newpassword:a.newpassword},f),success:function(a,b,c){0===a.error?(a.member.auth=c.getResponseHeader("X-Wdj-Auth"),u=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},w.checkPasscodeAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.passcode?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:s.checkPasscode,data:d({passcode:a.passcode},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},w.modifyPwdByCodeAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.username||void 0===a.passcode||void 0===a.password?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:s.modifyPwdByCode,data:d({username:a.username,passcode:a.passcode,password:a.password},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},w.updateProfileAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.nickname?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:s.completeProfile,data:d({nick:a.nickname},f),success:function(a){0===a.error?(u=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},w.activateAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.type?g.reject(e.missingParameters):c({type:"GET",dataType:"json",url:s.activate,data:d({type:a.type,account:a.account},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},w.activateValidAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.code?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:s.activateValid,data:d({code:a.code,type:"sms"},f),success:function(a){0===a.error?(u.telephoneValidated=!0,g.resolve(a)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},w.uploadAvatarAsync=function(d,f){var g=new b;d=d||{},f=f||{};var h,i;if(void 0===d.file)g.reject(e.missingParameters);else{h=new a.FormData,h.append("file",d.file);for(i in f)f.hasOwnProperty(i)&&h.append(i,f[i]);c({type:"POST",dataType:"json",url:s.avatar,data:h,processData:!1,contentType:!1,success:function(a){0===a.error?(u=a.member,g.resolve(a.member.avatar)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}})}return g.promise()},w.unbindThirdPartyAsync=function(a,f){var g=new b;a=a||{},f=f||{};var h={weibo:"1",sina:"1",qq:"2",renren:"3"};return void 0===a.platform||void 0===h[a.platform]?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:s.unbindThirdParty,data:d({platid:h[a.platform]},f),success:function(a){0===a.error?(u=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},w.confirmAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.code?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:s.confirm,data:d({code:a.code},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},w.isEmail=function(a){var b=/^\s*?(.+)@(.+?)\.(.+?)\s*$/;return b.test(a)},w.isPhoneNumber=function(a){var b=/^1[34578]\d{9}$/;return b.test(a)},w.loginWithThirdParty=function(b){b=b||{},b.callback=b.callback||"http://www.wandoujia.com/";var c={weibo:"sina",sina:"sina",renren:"renren",qq:"qq"},d=c[b.platform];delete b.platform;var e=b.onclose||function(){};delete b.onclose;var f,g=[];for(f in b)b.hasOwnProperty(f)&&g.push(f+"="+a.encodeURIComponent(b[f]));var h=t.loginWithThirdParty.replace("{1}",d);if(g.length>0&&(h=h+"?"+g.join("&")),b.popup)var i=window.open(h,"loginWithThirdParty","width=650, height=480"),j=setInterval(function(){i.closed&&(clearInterval(j),e.call(this))},200);else a.location.href=h};var x=a.SnapPea||{};x.Account=w,x.Utils=g,x.AliOpen=m,a.SnapPea=x}(this);